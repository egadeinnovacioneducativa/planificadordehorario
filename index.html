<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Horario Inteligente - 10 Semanas</title>
    <!-- Cargando React y Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Cargando Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Configuración de Impresión Reforzada */
        @media print {
            @page {
                size: landscape; /* Fuerza la orientación horizontal */
                margin: 5mm;
            }
            html, body {
                width: 100%;
                height: 100%;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .no-print { display: none !important; }
            
            /* Contenedor de impresión visible */
            .print-container {
                display: block !important;
                width: 100% !important;
                zoom: 85%; /* Mantiene la escala solicitada */
            }

            /* Forzar saltos de página por semana */
            .print-page-break {
                page-break-after: always !important;
                break-after: page !important;
                margin-bottom: 0 !important;
                padding-top: 5mm;
            }

            /* Asegurar que las tablas ocupen el ancho total en horizontal */
            .max-w-6xl {
                max-width: 100% !important;
                width: 100% !important;
            }
        }

        /* Estilos en pantalla */
        .print-container { display: none; }
        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auto-expand {
            resize: none;
            overflow: hidden;
            min-height: 28px;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef, useEffect } = React;

        // Iconos SVG internos
        const AlertTriangle = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/>
            </svg>
        );

        const Clock = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
            </svg>
        );

        const Printer = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/>
            </svg>
        );

        const MousePointer2 = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/><path d="m13 13 6 6"/>
            </svg>
        );

        const RotateCcw = ({ size = 16, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>
            </svg>
        );

        const CATEGORIES = {
            EMPTY: { id: 'empty', label: 'Vacío', color: 'bg-slate-100', text: 'text-slate-400', count: false },
            CLASES: { id: 'clases', label: 'Clases (Aula)', color: 'bg-blue-500', text: 'text-white', countType: 'clases' },
            AUTONOMO: { id: 'autonomo', label: 'Trabajo Autónomo', color: 'bg-green-500', text: 'text-white', countType: 'autonomo' },
            INSIGNIAS: { id: 'insignias', label: 'Exp. Insignias', color: 'bg-yellow-400', text: 'text-slate-900', countType: 'experiencias' },
            ACTIVACION: { id: 'activacion', label: 'Exp. Activación', color: 'bg-pink-400', text: 'text-white', countType: 'experiencias' },
            MICRO: { id: 'micro', label: 'Microexperiencias', color: 'bg-orange-500', text: 'text-white', countType: 'experiencias' },
        };

        const LIMITS = {
            clases: { label: 'Clases', limit: 15 },
            autonomo: { label: 'T. Autónomo', limit: 30 },
            experiencias: { label: 'Experiencias', limit: 5 }
        };

        const TIME_BLOCKS = [
            { start: '08:00', end: '09:30', duration: 1.5 },
            { start: '09:30', end: '11:00', duration: 1.5 },
            { start: '11:00', end: '11:30', duration: 0.5 },
            { start: '11:30', end: '13:00', duration: 1.5 },
            { start: '13:00', end: '14:30', duration: 1.5 },
            { start: '14:30', end: '15:30', duration: 1.0 },
            { start: '15:30', end: '17:00', duration: 1.5 },
            { start: '17:00', end: '18:30', duration: 1.5 },
        ];

        const DAYS = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'];
        const TOTAL_WEEKS = 10;

        // --- COMPONENTES AUXILIARES FUERA DE APP PARA EVITAR PÉRDIDA DE FOCO ---

        const ScheduleCell = ({ day, bIdx, cell, cat, isPrint, onNoteChange, onMouseDown, onMouseUp, onMouseLeave }) => {
            const textareaRef = useRef(null);

            // Ajuste automático de altura para el textarea
            useEffect(() => {
                if (textareaRef.current) {
                    textareaRef.current.style.height = "0px";
                    textareaRef.current.style.height = textareaRef.current.scrollHeight + "px";
                }
            }, [cell.note]);

            return (
                <div
                    onMouseDown={isPrint ? null : onMouseDown}
                    onMouseUp={isPrint ? null : onMouseUp}
                    onMouseLeave={isPrint ? null : onMouseLeave}
                    className={`w-full min-h-[60px] rounded-xl p-1.5 flex flex-col items-center justify-start relative select-none border-2
                        ${cat.color} ${cat.text} ${cell.catId === 'empty' ? 'border-dashed border-slate-200' : 'border-transparent shadow-sm hover:brightness-95'}
                        ${cell.isPainPoint ? 'ring-4 ring-red-600 border-red-500 scale-95 shadow-inner' : ''}
                        ${isPrint ? '' : 'cursor-pointer'}
                    `}
                >
                    <span className="text-[7px] font-black uppercase text-center leading-tight mb-1 opacity-70 tracking-tighter">
                        {cat.label}
                    </span>

                    {cell.catId !== 'empty' && (
                        <textarea
                            ref={textareaRef}
                            value={cell.note}
                            readOnly={isPrint}
                            onChange={(e) => onNoteChange(e.target.value)}
                            onMouseDown={(e) => e.stopPropagation()}
                            onMouseUp={(e) => e.stopPropagation()}
                            placeholder="..."
                            className={`w-full bg-transparent border-none outline-none text-[12px] text-center font-black leading-tight auto-expand placeholder:text-current placeholder:opacity-20
                                ${cat.text}
                            `}
                        />
                    )}
                    
                    {cell.isPainPoint && (
                        <div className="absolute top-0.5 right-0.5 w-4 h-4 bg-red-600 rounded-full border border-white flex items-center justify-center shadow-md">
                            <AlertTriangle size={10} className="text-white fill-white" />
                        </div>
                    )}
                </div>
            );
        };

        const WeekTable = ({ weekData, weekLabel, totals, trimestre, isPrint, handleNoteChange, handleMouseDown, handleMouseUp, timerRef }) => (
            <div className={`${isPrint ? 'print-page-break' : ''}`}>
                {/* Cabecera oficial para cada página de impresión */}
                {isPrint && (
                    <div className="flex justify-between items-center mb-6 px-2">
                        <div>
                            <h1 className="text-3xl font-black text-slate-900 leading-tight uppercase">PROGRAMA ACADÉMICO SEMANAL</h1>
                            <p className="text-slate-500 text-sm font-bold uppercase tracking-widest mt-1">Plan de Gestión del Tiempo</p>
                        </div>
                        <img src="https://image.admisiones.tec.mx/lib/fe2b11747364057f721176/m/1/b910ad21-1913-4ce0-8f35-38c908814125.png" alt="Logo" className="w-48 object-contain" />
                    </div>
                )}

                <div className="flex justify-between items-end mb-4">
                    <div className="flex gap-6 items-end">
                        <div className="flex flex-col">
                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Trimestre</span>
                            <span className="text-lg font-bold text-slate-800 border-b-2 border-slate-100 min-w-[140px]">{trimestre || "—"}</span>
                        </div>
                        <div className="flex flex-col">
                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Periodo</span>
                            <span className="text-lg font-bold text-indigo-600 border-b-2 border-indigo-100 min-w-[120px]">{weekLabel}</span>
                        </div>
                    </div>
                    
                    <div className="flex gap-3">
                        {Object.entries(LIMITS).map(([key, config]) => {
                            const current = totals[key];
                            const isOver = current > config.limit;
                            return (
                                <div key={key} className={`flex flex-col items-center justify-center px-6 py-2 rounded-xl transition-all ${isOver ? 'bg-red-600 text-white ring-4 ring-red-400 shadow-xl scale-110' : 'bg-white border-2 border-slate-200 shadow-sm'}`}>
                                    <span className={`text-[9px] font-black uppercase mb-1 tracking-tighter ${isOver ? 'text-red-100' : 'text-slate-400'}`}>{config.label}</span>
                                    <span className={`text-xl font-black flex items-center gap-2 ${isOver ? 'text-white' : 'text-slate-800'}`}>
                                        {isOver && <AlertTriangle size={18} className="fill-white text-red-600" />}
                                        {current.toFixed(1)} <span className={`text-xs ${isOver ? 'text-red-200' : 'text-slate-400'}`}>/ {config.limit}h</span>
                                    </span>
                                </div>
                            );
                        })}
                    </div>
                </div>

                <div className={`overflow-hidden rounded-2xl border border-slate-200 bg-white ${isPrint ? '' : 'shadow-xl'}`}>
                    <table className="w-full border-collapse min-w-[800px]">
                        <thead>
                            <tr className="bg-slate-800 text-white">
                                <th className="p-3 text-left font-semibold text-xs w-24">Horario</th>
                                {DAYS.map(day => <th key={day} className="p-3 text-center font-semibold text-xs">{day}</th>)}
                            </tr>
                        </thead>
                        <tbody>
                            {TIME_BLOCKS.map((block, bIdx) => (
                                <tr key={bIdx} className="border-b border-slate-100 last:border-0">
                                    <td className="p-3 bg-slate-50/50">
                                        <div className="text-lg font-black text-slate-800 leading-none">{block.start}</div>
                                        <div className="text-[9px] font-bold text-slate-400 mt-1 uppercase tracking-tight">al {block.end}</div>
                                    </td>
                                    {DAYS.map(day => {
                                        const cell = weekData[day][bIdx];
                                        const cat = CATEGORIES[cell.catId.toUpperCase()] || CATEGORIES.EMPTY;
                                        return (
                                            <td key={day} className="p-1">
                                                <ScheduleCell 
                                                    day={day} 
                                                    bIdx={bIdx} 
                                                    cell={cell} 
                                                    cat={cat} 
                                                    isPrint={isPrint} 
                                                    onNoteChange={(val) => handleNoteChange(day, bIdx, val)}
                                                    onMouseDown={() => handleMouseDown(day, bIdx)}
                                                    onMouseUp={() => handleMouseUp(day, bIdx)}
                                                    onMouseLeave={() => clearTimeout(timerRef.current)}
                                                />
                                            </td>
                                        );
                                    })}
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        // --- COMPONENTE PRINCIPAL ---

        function App() {
            const [schedules, setSchedules] = useState(() => {
                return Array.from({ length: TOTAL_WEEKS }, () => {
                    const week = {};
                    DAYS.forEach(day => {
                        week[day] = TIME_BLOCKS.map(() => ({ catId: 'empty', isPainPoint: false, note: '' }));
                    });
                    return week;
                });
            });

            const [activeWeekIndex, setActiveWeekIndex] = useState(0);
            const [trimestre, setTrimestre] = useState("");

            const timerRef = useRef(null);
            const isLongPress = useRef(false);

            // Cálculos de totales con los nuevos límites (15, 30, 5)
            const activeWeekTotals = useMemo(() => {
                const counts = { clases: 0, autonomo: 0, experiencias: 0 };
                const currentWeek = schedules[activeWeekIndex];
                DAYS.forEach(day => {
                    currentWeek[day].forEach((cell, index) => {
                        const catConfig = CATEGORIES[cell.catId.toUpperCase()];
                        if (catConfig && catConfig.countType) {
                            counts[catConfig.countType] += TIME_BLOCKS[index].duration;
                        }
                    });
                });
                return counts;
            }, [schedules, activeWeekIndex]);

            const getWeekTotals = (index) => {
                const counts = { clases: 0, autonomo: 0, experiencias: 0 };
                const currentWeek = schedules[index];
                DAYS.forEach(day => {
                    currentWeek[day].forEach((cell, idx) => {
                        const catConfig = CATEGORIES[cell.catId.toUpperCase()];
                        if (catConfig && catConfig.countType) {
                            counts[catConfig.countType] += TIME_BLOCKS[idx].duration;
                        }
                    });
                });
                return counts;
            };

            const handleCategoryChange = (day, blockIndex) => {
                const newSchedules = [...schedules];
                const currentCell = newSchedules[activeWeekIndex][day][blockIndex];
                const keys = Object.values(CATEGORIES).map(c => c.id);
                const nextIndex = (keys.indexOf(currentCell.catId) + 1) % keys.length;
                
                newSchedules[activeWeekIndex][day][blockIndex] = { ...currentCell, catId: keys[nextIndex] };
                setSchedules(newSchedules);
            };

            const handleNoteChange = (day, blockIndex, value) => {
                const newSchedules = [...schedules];
                newSchedules[activeWeekIndex][day][blockIndex].note = value;
                setSchedules(newSchedules);
            };

            const togglePainPoint = (day, blockIndex) => {
                const newSchedules = [...schedules];
                const cell = newSchedules[activeWeekIndex][day][blockIndex];
                newSchedules[activeWeekIndex][day][blockIndex] = { ...cell, isPainPoint: !cell.isPainPoint };
                setSchedules(newSchedules);
            };

            const resetAllSchedules = () => {
                if (window.confirm("¿Deseas borrar las 10 semanas de horario por completo?")) {
                    setSchedules(Array.from({ length: TOTAL_WEEKS }, () => {
                        const week = {};
                        DAYS.forEach(day => {
                            week[day] = TIME_BLOCKS.map(() => ({ catId: 'empty', isPainPoint: false, note: '' }));
                        });
                        return week;
                    }));
                    setTrimestre("");
                    setActiveWeekIndex(0);
                }
            };

            const handleMouseDown = (day, blockIndex) => {
                isLongPress.current = false;
                timerRef.current = setTimeout(() => {
                    togglePainPoint(day, blockIndex);
                    isLongPress.current = true;
                }, 600);
            };

            const handleMouseUp = (day, blockIndex) => {
                clearTimeout(timerRef.current);
                if (!isLongPress.current) handleCategoryChange(day, blockIndex);
            };

            return (
                <div className="min-h-screen p-4 md:p-8 font-sans no-select relative">
                    {/* UI INTERACTIVA */}
                    <div className="max-w-6xl mx-auto no-print">
                        
                        <div className="absolute top-4 right-4 md:top-8 md:right-8 w-32 md:w-48">
                            <img src="https://image.admisiones.tec.mx/lib/fe2b11747364057f721176/m/1/b910ad21-1913-4ce0-8f35-38c908814125.png" alt="Logo Tec" className="w-full h-auto" />
                        </div>

                        <header className="mb-6 pr-36">
                            <div className="flex flex-col md:flex-row md:items-start justify-between gap-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-slate-800 tracking-tight">Planificador de Horario</h1>
                                    <p className="text-slate-500 text-sm mt-1 flex items-center gap-2">
                                        <MousePointer2 size={14} className="text-blue-500" /> Clic cambia categoría • <span className="font-bold text-red-600 tracking-tighter">Mantén presionado</span> para Dolor
                                    </p>
                                </div>
                                <div className="flex flex-col items-end gap-2">
                                    <div className="flex gap-2">
                                        <button onClick={resetAllSchedules} className="flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-300 hover:bg-red-50 hover:text-red-600 rounded-lg shadow-sm text-xs font-bold transition-all">
                                            <RotateCcw size={14} /> Reiniciar Todo
                                        </button>
                                        <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg shadow-md text-xs font-bold transition-all active:scale-95">
                                            <Printer size={14} /> Guardar-Imprimir
                                        </button>
                                    </div>
                                    <div className="flex bg-slate-200 p-1 rounded-xl gap-1 flex-wrap justify-end max-w-sm md:max-w-none">
                                        {Array.from({ length: TOTAL_WEEKS }, (_, i) => i + 1).map((num, i) => (
                                            <button 
                                                key={num}
                                                onClick={() => setActiveWeekIndex(i)}
                                                className={`px-3 py-1.5 rounded-lg text-xs font-black transition-all ${activeWeekIndex === i ? 'bg-white text-indigo-600 shadow-sm scale-110' : 'text-slate-500 hover:bg-slate-300'}`}
                                            >
                                                S{num}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </header>

                        <div className="mb-8 max-w-[200px]">
                            <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 block">Trimestre</label>
                            <input 
                                type="text" 
                                value={trimestre} 
                                onChange={(e) => setTrimestre(e.target.value)}
                                placeholder="Ej. Invierno 2024"
                                className="w-full bg-transparent border-b-2 border-slate-200 focus:border-indigo-500 outline-none pb-1 font-bold text-slate-700 transition-colors placeholder:font-normal placeholder:text-slate-300"
                            />
                        </div>

                        <div key={activeWeekIndex} className="fade-in">
                            <WeekTable 
                                weekData={schedules[activeWeekIndex]} 
                                weekLabel={`Semana ${activeWeekIndex + 1}`} 
                                totals={activeWeekTotals}
                                trimestre={trimestre}
                                isPrint={false}
                                handleNoteChange={handleNoteChange}
                                handleMouseDown={handleMouseDown}
                                handleMouseUp={handleMouseUp}
                                timerRef={timerRef}
                            />
                        </div>

                        {/* Leyenda en pantalla */}
                        <div className="mt-8 flex flex-wrap items-center justify-center gap-6 py-5 border-t border-slate-200 bg-white/50 rounded-b-2xl no-print">
                            <div className="flex items-center gap-2"><div className="w-4 h-4 rounded-full bg-blue-500 shadow-sm"></div><span className="text-[10px] font-black text-blue-600 uppercase">Clases (Aula)</span></div>
                            <div className="flex items-center gap-2"><div className="w-4 h-4 rounded-full bg-green-500 shadow-sm"></div><span className="text-[10px] font-black text-green-600 uppercase">Trabajo Autónomo</span></div>
                            <div className="flex items-center gap-2"><div className="w-4 h-4 rounded-full bg-yellow-400 shadow-sm"></div><span className="text-[10px] font-black text-yellow-600 uppercase">Exp. Insignias</span></div>
                            <div className="flex items-center gap-2"><div className="w-4 h-4 rounded-full bg-pink-400 shadow-sm"></div><span className="text-[10px] font-black text-pink-500 uppercase">Exp. Activación</span></div>
                            <div className="flex items-center gap-2"><div className="w-4 h-4 rounded-full bg-orange-500 shadow-sm"></div><span className="text-[10px] font-black text-orange-600 uppercase">Microexperiencias</span></div>
                            <div className="flex items-center gap-2 ml-4 pl-4 border-l border-slate-300"><div className="w-4 h-4 rounded-full border-2 border-red-600 bg-white flex items-center justify-center shadow-sm"><div className="w-1.5 h-1.5 bg-red-600 rounded-full"></div></div><span className="text-[10px] font-black text-red-600 uppercase">Punto de Dolor</span></div>
                        </div>
                    </div>

                    {/* CONTENEDOR DE IMPRESIÓN (Visible en PDF/Papel) */}
                    <div className="print-container no-select">
                        {schedules.map((week, idx) => (
                            <WeekTable 
                                key={idx}
                                weekData={week}
                                weekLabel={`Semana ${idx + 1}`}
                                totals={getWeekTotals(idx)}
                                trimestre={trimestre}
                                isPrint={true}
                                handleNoteChange={handleNoteChange}
                                handleMouseDown={handleMouseDown}
                                handleMouseUp={handleMouseUp}
                                timerRef={timerRef}
                            />
                        ))}
                        
                        <div className="flex items-center justify-center gap-6 py-4 border-t border-slate-200 mt-4">
                            <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Leyenda:</span>
                            <div className="flex items-center gap-1"><div className="w-2.5 h-2.5 rounded-full bg-blue-500"></div><span className="text-[9px] font-bold text-blue-700">Clases</span></div>
                            <div className="flex items-center gap-1"><div className="w-2.5 h-2.5 rounded-full bg-green-500"></div><span className="text-[9px] font-bold text-green-700">Autónomo</span></div>
                            <div className="flex items-center gap-1"><div className="w-2.5 h-2.5 rounded-full bg-yellow-400"></div><span className="text-[9px] font-bold text-yellow-600">Insignias</span></div>
                            <div className="flex items-center gap-1"><div className="w-2.5 h-2.5 rounded-full bg-pink-400"></div><span className="text-[9px] font-bold text-pink-600">Activación</span></div>
                            <div className="flex items-center gap-1"><div className="w-2.5 h-2.5 rounded-full bg-orange-500"></div><span className="text-[9px] font-bold text-orange-600">Micro</span></div>
                            <div className="flex items-center gap-1"><div className="w-2.5 h-2.5 border border-red-600 rounded-full"></div><span className="text-[9px] font-bold text-red-600">Dolor</span></div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
